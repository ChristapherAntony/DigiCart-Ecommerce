<div class="breadcrumb-area bg-gray menuBarTop">
    <div class="container">
        <div class="breadcrumb-content text-center">
            <ul>
                <li>
                    <a href="/">Home</a>
                </li>
                <li class="active">my account </li>
            </ul>
        </div>
    </div>
</div>
<!-- my account wrapper start -->
<div class="my-account-wrapper pt-50 pb-120" style="">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <!-- My Account Page Start -->
                <div class="myaccount-page-wrapper">
                    <!-- My Account Tab Menu Start -->
                    <div class="row">
                        <div class="col-lg-3 col-md-4">
                            <div class="myaccount-tab-menu nav" role="tablist">
                                <a href="#dashboad" class="active" data-toggle="tab"><i class="fa fa-dashboard"></i>
                                    Dashboard</a>
                                <a href="#orders" data-toggle="tab"><i class="fa fa-cart-arrow-down"></i> Orders</a>
                                <a href="#wallet" data-toggle="tab"><i class="fa fa-wallet"></i> Wallet</a>
                                <a href="#payment-method" data-toggle="tab"><i class="fa fa-credit-card"></i> Payment
                                    Method</a>
                                <a href="#address-edit" data-toggle="tab"><i class="fa fa-map-marker"></i> address</a>
                                <a href="#account-info" data-toggle="tab"><i class="fa fa-user"></i> Account Details</a>
                                <a href="/logOut"><i class="fa fa-sign-out"></i> Logout</a>
                            </div>
                        </div>
                        <!-- My Account Tab Menu End -->
                        <!-- My Account Tab Content Start -->
                        <div class="col-lg-9 col-md-8">
                            <div class="tab-content" id="myaccountContent">
                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade show active" id="dashboad" role="tabpanel">
                                    <div class="myaccount-content">
                                        <h3>Dashboard</h3>
                                        <div class="welcome">
                                            <p>Hello, <strong>{{userName}}</strong> </p>
                                        </div>
                                        <p class="mb-0">From your account dashboard. you can easily check & view your
                                            recent orders, manage your shipping and billing addresses and edit your
                                            password and account details.</p>
                                    </div>
                                    <div class="myaccount-content">
                                        <h3>Referral Code</h3>
                                        <div class="welcome">
                                            <p>Share this code to a new user and get a <i
                                                    class="bi bi-currency-rupee"></i> 1000 as a referral bonus on their
                                                Sign Up</p>
                                            <span class="border border-danger p-2"
                                                id="p1">{{userDetails.referralId}}</span><button
                                                style="background-color: rgb(228,67,17); color: white;"
                                                class="btn btn-sm ml-2" onclick="copyToClipboard('#p1')">Copy</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- Single Tab Content End -->
                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade " id="orders" role="tabpanel">
                                    <div class="cart-main-area pt-0 pb-0">
                                        <div class="container">
                                            <h3 class="cart-page-title">Your Order items</h3>
                                            <div class="row">
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-12">
                                                    <form>
                                                        <div
                                                            class="table-content table-responsive cart-table-content d-none d-md-block">
                                                            <table class="text-left">
                                                                <thead>
                                                                    <tr>
                                                                        <th>#</th>
                                                                        <th>Date</th>
                                                                        <th>Address</th>
                                                                        <th>Bill Amount</th>
                                                                        <th>Action</th>

                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {{#each orders}}
                                                                    <tr>
                                                                        <td class="product-name "><a href="#">
                                                                                {{@index}}</a></td>
                                                                        <td class="product-name text-left"><a href="#">
                                                                                {{this.orderDate}}</a></td>
                                                                        <td class="product-price-cart text-left"><span>
                                                                                {{this.deliveryDetails.Name}} <br>
                                                                                {{this.deliveryDetails.TownCity}}-{{this.deliveryDetails.State}}
                                                                                <br>
                                                                                {{this.deliveryDetails.Country}}-{{this.deliveryDetails.PostCode}}
                                                                            </span></td>

                                                                        <td class="product-subtotal ">
                                                                            Rs.{{this.totalAmount}}</td>
                                                                        <td class="product-wishlist-cart ">
                                                                            <a href="/orderDetails/{{this._id}}">View
                                                                                Order</a>

                                                                        </td>
                                                                    </tr>
                                                                    {{/each }}
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                        {{!-- dcksdncksdl --}}
                                                        <div
                                                            class="table-content table-responsive cart-table-content d-block d-md-none">
                                                            
                                                            {{#each orders}}
                                                            <div
                                                                style="">
                                                                <div>
                                                                    <span class="float-left ">{{@index}}</span><div class="float-right ">Date: {{this.orderDate}} </div> 
                                                                </div><br>
                                                                <p class="">
                                                                    <p>Shipping Address</p>
                                                                    {{this.deliveryDetails.Name}} <br>
                                                                    {{this.deliveryDetails.TownCity}}-{{this.deliveryDetails.State}}
                                                                    <br>
                                                                    {{this.deliveryDetails.Country}}-{{this.deliveryDetails.PostCode}}

                                                                </p>
                                                                <div class=" mb-5 " >
                                                                    <div class="col-6" >
                                                                        Rs.{{this.totalAmount}}</div>
                                                                    <div class="col-6">
                                                                        <a class="btn btn-sm btn-danger" href="/orderDetails/{{this._id}}">View
                                                                            Order</a>

                                                                    </div>
                                                                    
                                                                </div>

                                                            </div>
                                                            {{/each }}
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Single Tab Content End -->
                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade" id="wallet" role="tabpanel">
                                    <div class="myaccount-content">
                                        <div class="row">
                                            <h3 class="col-md-9">Wallet</h3>
                                            <h3 class="col-md-3 mr-auto">Balance:<i class="bi bi-currency-rupee"></i>
                                                {{wallet.walletBalance}}</h3>
                                        </div>


                                        <div class="myaccount-table table-responsive ">
                                            <table class="table table-bordered">
                                                <thead class="thead-light">
                                                    <tr>
                                                        <th scope="col">#</th>
                                                        <th scope="col">Date</th>
                                                        <th scope="col">Title</th>
                                                        <th scope="col">Transaction</th>
                                                        <th scope="col">Amount</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {{#each wallet.walletTransaction}}
                                                    <tr>
                                                        <th scope="row" class="create_index"></th>
                                                        <td>{{this.date}}</td>
                                                        <td>{{this.title}}</td>
                                                        <td>{{this.transaction}} ({{this.user}})</td>
                                                        <td>{{this.amount}}</td>
                                                    </tr>
                                                    {{/each }}
                                                </tbody>
                                            </table>

                                        </div>

                                    </div>
                                </div>
                                <!-- Single Tab Content End -->
                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade" id="payment-method" role="tabpanel">
                                    <div class="myaccount-content">
                                        <h3>Payment Method</h3>
                                        <p class="saved-message">You Can't Saved Your Payment Method yet.</p>
                                    </div>
                                </div>
                                <!-- Single Tab Content End -->
                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade" id="address-edit" role="tabpanel">
                                    <div class="myaccount-content">
                                        <h3>Billing Address</h3>
                                        <address>
                                            <a href="/addAddress" class="float-right btn btn-primary">Add new</a>
                                        </address>
                                        {{#each address}}
                                        <div id="{{this.Address.addressId}}">
                                            <address>
                                                <p><strong>{{this.Address.Name}}</strong></p>
                                                <p>{{this.Address.HouseNo}} , {{this.Address.Street}}
                                                    ,{{this.Address.TownCity}} <br>
                                                    {{this.Address.State}} , {{this.Address.Country}} ,
                                                    Pin-{{this.Address.PostCode}}</p>
                                                <p>Mobile: {{this.Address.Mobile}}</p>
                                            </address>
                                            <a href="/editAddress/{{@index}}" class="check-btn sqr-btn "><i
                                                    class="fa fa-edit"></i> Edit
                                                Address</a>
                                            <button style="border: none;"
                                                onclick="removeAddress('{{this.Address.addressId}}')"
                                                class="check-btn sqr-btn "><i class="bi bi-trash3"></i> Delete</button>
                                        </div>
                                        <br>
                                        <hr>
                                        {{/each}}
                                    </div>
                                </div>
                                <!-- Single Tab Content End -->
                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade" id="account-info" role="tabpanel">
                                    <div class="myaccount-content">
                                        <h3>Account Details</h3>
                                        <div class="account-details-form">
                                            <form id="profile-form" action="#" method="post">
                                                <input type="text" name="userId" id="" value="{{userDetails._id}} "
                                                    hidden>
                                                <div class="single-input-item">
                                                    <label for="UserName" class="required">Name</label>
                                                    <input type="text" id="field1" name="UserName"
                                                        value="{{userDetails.UserName}}" />
                                                </div>
                                                <div class="single-input-item">
                                                    <label for="email" class="required">Email Adders</label>
                                                    <input type="text" id="field2" name="UserEmail"
                                                        value="{{userDetails.UserEmail}}" />
                                                </div>
                                                <div class="single-input-item">
                                                    <label for="mobile" class="required">Mobile Number</label>
                                                    <input type="number" id="field3" name="MobileNo"
                                                        value="{{userDetails.MobileNo}}" />
                                                </div>
                                                {{!-- <fieldset>
                                                    <legend>Password change</legend>
                                                    <div class="single-input-item">
                                                        <label for="current-pwd" class="required">Current
                                                            Password</label>
                                                        <input type="password" id="current-pwd" />
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <div class="single-input-item">
                                                                <label for="new-pwd" class="required">New
                                                                    Password</label>
                                                                <input type="password" id="new-pwd" />
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="single-input-item">
                                                                <label for="confirm-pwd" class="required">Confirm
                                                                    Password</label>
                                                                <input type="password" id="confirm-pwd" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </fieldset> --}}
                                                <div class="single-input-item">
                                                    <button type="submit" class="btn btn-danger float-left "
                                                        id="save">Update </button>
                                                    {{!-- <a class="btn btn-danger float-right " id="edit">Edit</a> --}}
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div> <!-- Single Tab Content End -->
                            </div>
                        </div> <!-- My Account Tab Content End -->
                    </div>
                </div> <!-- My Account Page End -->
            </div>
        </div>
    </div>
</div>

<script>
    $('#profile-form').submit((e) => {
        e.preventDefault()
        let UserName = document.getElementById('field1')
        let UserEmail = document.getElementById('field2')
        let MobileNo = document.getElementById('field3')
        Swal.fire({
            title: 'Do you want to save the changes?',
            showDenyButton: true,
            showCancelButton: true,
            confirmButtonText: 'Save',
            denyButtonText: `Don't save`,
        }).then((result) => {
            /* Read more about isConfirmed, isDenied below */
            if (result.isConfirmed) {
                $.ajax({
                    url: '/updateProfile',
                    method: 'post',
                    data: $('#profile-form').serialize(),
                    success: (response) => {
                        console.log(response.UserName)
                        document.getElementById('field1').innerHTML = response.UserName
                        document.getElementById('field2').innerHTML = response.UserEmail
                        document.getElementById('field3').innerHTML = response.MobileNo
                    }
                })
                Swal.fire({
                    icon: 'success',
                    title: 'Your Profile Updated',
                    showConfirmButton: false,
                    timer: 1000
                })
            } else if (result.isDenied) {
                document.getElementById('field1').innerHTML = UserName
                document.getElementById('field2').innerHTML = UserEmail
                document.getElementById('field3').innerHTML = MobileNo
                Swal.fire({

                    icon: 'info',
                    title: 'Changes are not saved',
                    showConfirmButton: false,
                    timer: 1000
                })
            }
        })
    })

    function removeAddress(addressId) {
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: '/deleteAddress',
                    data: {
                        addressId: addressId
                    },
                    method: 'get',
                    success(response) {
                        Swal.fire(
                            'Deleted!',
                            'Your file has been deleted.',
                            'success'
                        )
                        document.getElementById(addressId).remove()
                    }
                })
                Swal.fire(
                    'Deleted!',
                    'Your file has been deleted.',
                    'success'
                )
            }
        })
    }



    function disable() {
        document.getElementById("field1").disabled = true;
        let x = document.getElementById("save");
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
        let y = document.getElementById("edit");
        if (y.style.display === "block") {
            y.style.display = "none";
        } else {
            y.style.display = "block";
        }

    }
    function enable() {
        document.getElementById("field1").disabled = false;
        let y = document.getElementById("edit");
        if (y.style.display === "none") {
            y.style.display = "block";
        } else {
            y.style.display = "none";
        }
        let x = document.getElementById("save");
        if (x.style.display === "block") {
            x.style.display = "none";
        } else {
            x.style.display = "block";
        }
    }



</script>